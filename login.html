<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login â€“ Mobile Lab Mityana</title>
<meta name="theme-color" content="#0ea5e9">

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
:root{
  --primary:#0ea5e9;
  --primary2:#14b8a6;
  --dark:#0f172a;
  --muted:#64748b;
  --border:rgba(15,23,42,0.12);
  --card:rgba(255,255,255,0.95);
  --shadow:0 12px 30px rgba(2,6,23,0.12);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:linear-gradient(rgba(241,245,249,0.9),rgba(241,245,249,0.9));
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}
.card{
  width:100%;
  max-width:420px;
  background:var(--card);
  border-radius:18px;
  box-shadow:var(--shadow);
  overflow:hidden;
}
.hero{
  background:linear-gradient(135deg,var(--primary),var(--primary2));
  padding:16px;
  text-align:center;
  color:#fff;
}
.hero img{
  width:100%;
  max-height:220px;
  object-fit:cover;
  border-radius:12px;
  margin-bottom:12px;
}
.hero h2{margin:6px 0;font-size:22px}
.hero p{margin:4px 0;font-size:13px;opacity:.95}
.form{padding:18px;}
label{font-weight:700;font-size:13px;}
input{
  width:100%;
  padding:12px;
  margin:6px 0 14px;
  border-radius:12px;
  border:1px solid var(--border);
}
input:focus{
  outline:none;
  border-color:var(--primary);
  box-shadow:0 0 0 4px rgba(14,165,233,.18);
}
button{
  width:100%;
  padding:13px;
  border:none;
  border-radius:14px;
  font-size:16px;
  font-weight:800;
  cursor:pointer;
  color:#fff;
  background:linear-gradient(135deg,var(--primary),var(--primary2));
}
.msg{text-align:center;font-size:14px;margin-top:12px;font-weight:700;}
.footer{text-align:center;font-size:12px;color:var(--muted);padding:12px;}
a{color:var(--primary);text-decoration:none;font-weight:700}
</style>
</head>

<body>

<div class="card">
  <div class="hero">
    <!-- Make sure this matches your deployed filename -->
    <img src="lab-bg.jpg" alt="Laboratory Work">
    <h2>ðŸ§ª Mobile Laboratory â€“ Mityana</h2>
    <p>Quality Diagnostics â€¢ Trusted Results</p>
    <p>ðŸ“ž 0750 992 939 | 0778 379 791</p>
  </div>

  <div class="form">
    <label>Email</label>
    <input type="email" id="email" placeholder="Enter your email" required>

    <label>Password</label>
    <input type="password" id="password" placeholder="Enter your password" required>

    <button onclick="login()">Login</button>
    <div class="msg" id="msg"></div>
  </div>

  <div class="footer">
    New patient? <a href="register.html">Create an account</a><br>
    Serving Mityana & nearby areas
  </div>
</div>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyA4II_I1weZZGzP990t9UWJCXjuK932pdY",
  authDomain: "mobile-lab-mityana-aeae2.firebaseapp.com",
  projectId: "mobile-lab-mityana-aeae2",
  storageBucket: "mobile-lab-mityana-aeae2.firebasestorage.app",
  messagingSenderId: "624002906588",
  appId: "1:624002906588:web:08b4259f90ffa9adad7719"
};

// Initialize Firebase
if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

async function login(){
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value;
  const msg = document.getElementById("msg");

  msg.style.color = "#000";
  msg.innerText = "Signing in...";

  try {
    const cred = await auth.signInWithEmailAndPassword(email, password);
    const user = cred.user;

    // Auto-create Firestore document if missing
    const ref = db.collection("users").doc(user.uid);
    const snap = await ref.get();

    if (!snap.exists) {
      await ref.set({
        email: user.email,
        role: "user",
        created_at: firebase.firestore.FieldValue.serverTimestamp()
      });
    }

    msg.style.color = "green";
    msg.innerText = "Login successful. Redirecting...";

    setTimeout(async () => {
  const snap = await db.collection("users").doc(user.uid).get();

  if (snap.exists && snap.data().role === "admin") {
    window.location.href = "nindex.html";
  } else {
    window.location.href = "index.html"; // patient page
  }
}, 1000);


  } catch(err) {
    msg.style.color = "red";
    msg.innerText = err.message;
  }
}
</script>

</body>
</html>
