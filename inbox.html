<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ðŸ“¥ Patient Inbox</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
  font-family: Arial;
  background:#f8fafc;
  padding:20px;
}
.result{
  background:#fff;
  padding:14px;
  border-radius:12px;
  margin-bottom:12px;
  box-shadow:0 8px 18px rgba(0,0,0,.08);
}
</style>
</head>

<body>

<h2>ðŸ“¥ Your Lab Results</h2>
<div id="list">Loading...</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyA4II_I1weZZGzP990t9UWJCXjuK932pdY",
  authDomain: "mobile-lab-mityana-aeae2.firebaseapp.com",
  projectId: "mobile-lab-mityana-aeae2"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

auth.onAuthStateChanged(user=>{
  if(!user){
    window.location.href="login.html";
    return;
  }

  db.collection("results")
    .where("patientEmail","==",user.email)
    .orderBy("createdAt","desc")
    .onSnapshot(snapshot=>{
      if(snapshot.empty){
        list.innerHTML="No results yet";
        return;
      }

      list.innerHTML="";
      snapshot.forEach(doc=>{
        const d=doc.data();
        list.innerHTML+=`
          <div class="result">
            <b>${d.testName}</b><br>
            ${d.resultText}<br>
            <small>${d.createdAt?.toDate().toLocaleString()}</small>
          </div>`;
      });
    });
});
</script>

</body>
</html>
