<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mobile Lab Order</title>

  <!-- EmailJS -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script>
    (function() { emailjs.init({ publicKey: "QPXYuZG5LIiv_1x3H" }); })();
  </script>

  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f0f4f8; color:#333; }
    .container { max-width:700px; margin:20px auto; padding:20px; background:white; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,0.1); }
    .header { text-align:center; background:#e6f7ff; padding:15px; border-radius:10px; margin-bottom:20px; }
    .header h2 { margin:5px 0; color:#006699; }
    .header h3 { margin:5px 0; color:#009966; font-weight:normal; font-size:1em; }
    form label { font-weight:bold; margin-top:10px; display:block; }
    input, select { margin:5px 0 15px 0; padding:10px; width:100%; border:1px solid #ccc; border-radius:6px; font-size:1em; }
    .tests-container { max-height:250px; overflow-y:auto; padding:5px; border:1px solid #ccc; border-radius:6px; background:#f9f9f9; }
    .tests-container label { display:block; margin-bottom:5px; font-weight:normal; }
    button { background:#009966; color:white; padding:12px; border:none; border-radius:6px; cursor:pointer; font-size:1em; width:100%; }
    button:hover { background:#007744; }
    .payment-details { display:none; margin:10px 0; padding:10px; border-radius:6px; }
    #mtnDetails { background:#fff3cd; border:1px solid #ffeeba; }
    #airtelDetails { background:#e6f7ff; border:1px solid #b3e0ff; }
    #confirmation { font-weight:bold; margin-top:15px; text-align:center; color:green; }
    @media(max-width:600px){ .container { margin:10px; padding:15px; } .tests-container { max-height:150px; } }
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <h2>üß™ Mobile Lab Order Form</h2>
    <h3>Motto: "Fast, Reliable, and Affordable Diagnostics at Your Doorstep"</h3>
    <h3>Vision: "To make quality healthcare accessible anytime, anywhere."</h3>
  </div>

  <form id="orderForm">
    <label>Full Name:</label>
    <input type="text" id="name" required>

    <label>Age:</label>
    <input type="number" id="age" min="1" required>

    <label>Sex:</label>
    <select id="sex" required>
      <option value="">-- Select --</option>
      <option value="Male">Male</option>
      <option value="Female">Female</option>
      <option value="Other">Other</option>
    </select>

    <label>Phone:</label>
    <input type="tel" id="phone" required>

    <label>Select Tests:</label>
    <div class="tests-container">
      <label><input type="checkbox" class="test" value="CBC" data-price="15000"> CBC (15,000 UGX)</label>
      <label><input type="checkbox" class="test" value="Hb" data-price="10000"> Hb (10,000 UGX)</label>
      <label><input type="checkbox" class="test" value="Blood Glucose" data-price="7000"> Blood Glucose (7,000 UGX)</label>
      <label><input type="checkbox" class="test" value="RFT" data-price="50000"> Kidney Function Test (50,000 UGX)</label>
      <label><input type="checkbox" class="test" value="LFT" data-price="50000"> Liver Function Test (50,000 UGX)</label>
      <label><input type="checkbox" class="test" value="Electrolytes" data-price="50000"> Electrolytes (50,000 UGX)</label>
      <label><input type="checkbox" class="test" value="Blood Smear" data-price="5000"> Blood Smear (5,000 UGX)</label>
      <label><input type="checkbox" class="test" value="RPR/Syphilis" data-price="8000"> RPR/Syphilis (8,000 UGX)</label>
      <label><input type="checkbox" class="test" value="HIV" data-price="7000"> HIV (7,000 UGX)</label>
      <label><input type="checkbox" class="test" value="Hep B" data-price="10000"> Hep B (10,000 UGX)</label>
      <label><input type="checkbox" class="test" value="Hep C" data-price="10000"> Hep C (10,000 UGX)</label>
      <label><input type="checkbox" class="test" value="Stool Analysis" data-price="15000"> Stool Analysis (15,000 UGX)</label>
      <label><input type="checkbox" class="test" value="Brucella Test" data-price="10000"> Brucella Test (10,000 UGX)</label>
    </div>

    <label>Location:</label>
    <input type="text" id="location" required>

    <label>Payment Method:</label>
    <select id="payment" required>
      <option value="">-- Select --</option>
      <option value="Cash on Delivery">Cash on Delivery</option>
      <option value="MTN Mobile Money">MTN Mobile Money</option>
      <option value="Airtel Money">Airtel Money</option>
      <option value="Card">Card</option>
    </select>

    <div id="mtnDetails" class="payment-details">
      üì≤ MTN Mobile Money Payment:<br>Number: <b>0778379591</b><br>Name: <b>Kwikiriza Jenipher</b>
    </div>

    <div id="airtelDetails" class="payment-details">
      üì≤ Airtel Money Payment:<br>Number: <b>0706559100</b><br>Name: <b>Nambi Amina</b>
    </div>

    <label>Total (UGX):</label>
    <input type="text" id="total" readonly value="0">

    <button type="submit">Submit Order</button>
  </form>

  <div id="confirmation"></div>
</div>

<script>
  const testCheckboxes = document.querySelectorAll(".test");
  const totalInput = document.getElementById("total");
  const paymentSelect = document.getElementById("payment");
  const mtnDetails = document.getElementById("mtnDetails");
  const airtelDetails = document.getElementById("airtelDetails");
  const confirmationDiv = document.getElementById("confirmation");
  const whatsappNumber = "750992939";
  const serviceID = "service_sjp4zrf";
  const templateID = "lab_order";

  function updateTotal() {
    let total = 0;
    testCheckboxes.forEach(cb => { if(cb.checked) total += parseInt(cb.getAttribute("data-price")); });
    totalInput.value = total.toLocaleString();
  }
  testCheckboxes.forEach(cb => cb.addEventListener("change", updateTotal));

  paymentSelect.addEventListener("change", function() {
    mtnDetails.style.display = paymentSelect.value==="MTN Mobile Money" ? "block" : "none";
    airtelDetails.style.display = paymentSelect.value==="Airtel Money" ? "block" : "none";
  });

  document.getElementById("orderForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const name = document.getElementById("name").value;
    const age = document.getElementById("age").value;
    const sex = document.getElementById("sex").value;
    const phone = document.getElementById("phone").value;
    const location = document.getElementById("location").value;
    const payment = document.getElementById("payment").value;
    const total = totalInput.value;

    let testsSelected = [];
    testCheckboxes.forEach(cb => {
      if(cb.checked) testsSelected.push(`${cb.value} (UGX ${parseInt(cb.getAttribute("data-price")).toLocaleString()})`);
    });

    let paymentDetails = payment;
    if(payment==="MTN Mobile Money") paymentDetails += " - 0778379591 (Kwikiriza Jenipher)";
    if(payment==="Airtel Money") paymentDetails += " - 0706559100 (Nambi Amina)";

    const orderMessage = `üß™ Mobile Lab Order:\nName: ${name}\nAge: ${age}\nSex: ${sex}\nPhone: ${phone}\nTests:\n${testsSelected.join("\n")}\nTotal: UGX ${total}\nLocation: ${location}\nPayment: ${paymentDetails}`;

    // WhatsApp
    window.open(`https://wa.me/${whatsappNumber}?text=${encodeURIComponent(orderMessage)}`, '_blank');

    // EmailJS
    emailjs.send(serviceID, templateID, {
      name: name,
      age: age,
      sex: sex,
      phone: phone,
      tests: testsSelected.join("<br>"),
      total: `UGX ${total}`,
      location: location,
      payment: paymentDetails
    }).then(() => {
      confirmationDiv.textContent = "‚úÖ Order submitted successfully via WhatsApp and Email!";
      document.getElementById("orderForm").reset();
      totalInput.value = "0";
      mtnDetails.style.display = "none";
      airtelDetails.style.display = "none";
    }, (err) => {
      confirmationDiv.textContent = "‚ùå Failed to send order. Please try again.";
      console.error(err);
    });
  });
</script>

</body>
</html>
