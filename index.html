<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mobile Lab â€“ Mityana Uganda</title>

<link rel="manifest" href="manifest.json">

<style>
body{font-family:Arial;background:#f4f7fa;margin:0}
header{background:#0a7cff;color:#fff;padding:15px;text-align:center}
.container{max-width:1000px;margin:20px auto;background:#fff;padding:20px;border-radius:10px}
.section{margin-top:25px}
h3{color:#0a7cff}
ul{padding-left:20px}
li{margin:5px 0}
.card{border:1px solid #ddd;padding:15px;border-radius:8px;margin-bottom:15px}
button{padding:10px 15px;border:none;border-radius:5px;background:#0a7cff;color:#fff;cursor:pointer}
.red{background:#c62828}
.hidden{display:none}
.logout{margin-top:40px;text-align:center}
</style>
</head>

<body>

<header>
<h2>Mobile Laboratory â€“ Mityana</h2>
<p>Accurate â€¢ Affordable â€¢ Reliable</p>
</header>

<div class="container">

<!-- ACCOUNT INFO -->
<div id="accountInfo" class="card hidden">
<h3>Account Holder</h3>
<p><b>Name:</b> <span id="accName"></span></p>
<p><b>Email:</b> <span id="accEmail"></span></p>
<p><b>Phone:</b> <span id="accPhone"></span></p>
<p><b>Role:</b> <span id="accRole"></span></p>
</div>

<!-- PATIENT DASHBOARD -->
<div id="patientDash" class="hidden">

<div class="section">
<h3>HAEMATOLOGY</h3>
<ul>
<li>Complete Blood Count (CBC)</li>
<li>ESR</li>
<li>Blood Grouping</li>
<li>Peripheral Blood Film</li>
<li>Hb%</li>
<li>Sickle Cell Screening</li>
</ul>
</div>

<div class="section">
<h3>BIOCHEMISTRY</h3>
<ul>
<li>Fasting Blood Sugar (FBS)</li>
<li>Random Blood Sugar (RBS)</li>
<li>Liver Function Tests (LFT)</li>
<li>Renal Function Tests (RFT)</li>
<li>Lipid Profile</li>
<li>Uric Acid</li>
<li>Creatinine</li>
<li>Electrolytes</li>
</ul>
</div>

<div class="section">
<h3>SEROLOGY</h3>
<ul>
<li>HIV</li>
<li>HBsAg</li>
<li>HCV</li>
<li>VDRL / RPR</li>
<li>H. Pylori</li>
<li>ASO</li>
<li>CRP</li>
</ul>
</div>

<div class="section">
<h3>MICROBIOLOGY</h3>
<ul>
<li>Urinalysis</li>
<li>Stool Analysis</li>
<li>Blood Culture</li>
<li>Urine Culture</li>
<li>Stool Culture</li>
<li>Sputum MCS</li>
</ul>
</div>

<div class="section">
<h3>HORMONAL & OTHER TESTS</h3>
<ul>
<li>PSA</li>
<li>Pregnancy Test</li>
<li>TSH</li>
<li>T3 / T4</li>
</ul>
</div>

<div class="section">
<button onclick="location.href='inbox.html'">ðŸ“¥ View Results Inbox</button>
</div>

</div>
<!-- ADMIN DASHBOARD -->
<div id="adminDash" class="hidden">

<div class="section">
<h3>Admin â€“ Patient Test Requests</h3>
<div id="orders"></div>
</div>

</div>

<div class="logout">
<button id="logoutBtn" class="red hidden">Logout</button>
</div>

</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyA4II_I1weZZGzP990t9UWJCXjuK932pdY",
  authDomain: "mobile-lab-mityana-aeae2.firebaseapp.com",
  projectId: "mobile-lab-mityana-aeae2",
  storageBucket: "mobile-lab-mityana-aeae2.appspot.com",
  messagingSenderId: "624002906588",
  appId: "1:624002906588:web:08b4259f90ffa9adad7719"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const ADMIN_EMAIL = "edrinehero@gmail.com";

auth.onAuthStateChanged(async user=>{
  if(!user){
    window.location.href="login.html";
    return;
  }

  document.getElementById("logoutBtn").classList.remove("hidden");
  document.getElementById("accountInfo").classList.remove("hidden");

  document.getElementById("accEmail").textContent=user.email || "-";
  document.getElementById("accPhone").textContent=user.phoneNumber || "-";

  const snap=await db.collection("users").doc(user.uid).get();
  if(snap.exists){
    document.getElementById("accName").textContent=snap.data().name || "-";
  }

  if(user.email===ADMIN_EMAIL){
    document.getElementById("accRole").textContent="Admin";
    document.getElementById("adminDash").classList.remove("hidden");
    loadOrders();
  }else{
    document.getElementById("accRole").textContent="Patient";
    document.getElementById("patientDash").classList.remove("hidden");
  }
});

document.getElementById("logoutBtn").onclick=()=>{
  auth.signOut();
};

async function loadOrders(){
  const ordersDiv=document.getElementById("orders");
  ordersDiv.innerHTML="Loading...";
  const q=await db.collection("orders").orderBy("created","desc").get();
  ordersDiv.innerHTML="";
  q.forEach(d=>{
    const o=d.data();
    ordersDiv.innerHTML+=`
      <div class="card">
      <p><b>Patient:</b> ${o.name}</p>
      <p><b>Tests:</b> ${o.tests.join(", ")}</p>
      <p><b>Status:</b> ${o.status || "Pending"}</p>
      </div>`;
  });
}
</script>

</body>
</html>
