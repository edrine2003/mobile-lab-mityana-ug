<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mobile Lab Order â€“ Mityana Uganda</title>

<meta name="description" content="Book mobile lab tests in Mityana, Uganda.">
<meta name="theme-color" content="#0ea5e9">

<link rel="manifest" href="manifest.json">
<link rel="icon" href="icon-192.png">

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
:root{
  --primary:#0ea5e9;
  --primary2:#14b8a6;
  --dark:#0f172a;
  --muted:#64748b;
  --border:rgba(15,23,42,0.12);
  --card:rgba(255,255,255,0.92);
  --shadow:0 12px 30px rgba(2,6,23,0.12);
}
*{box-sizing:border-box}
body{
  font-family: Arial, sans-serif;
  margin:0;
  background:#f4f7fa;
  color: var(--dark);
}
.container{max-width:900px;margin:18px auto;padding:16px;}
.card{
  background: var(--card);
  border:1px solid var(--border);
  border-radius:18px;
  box-shadow: var(--shadow);
  overflow:hidden;
}
.header{
  background: linear-gradient(135deg,var(--primary),var(--primary2));
  color:#fff;
  padding:18px 16px;
  text-align:center;
}
.header h2{margin:0;font-size:22px;}
.header p{margin:6px 0 0;font-size:13px;opacity:0.95;}
.header-actions{
  margin-top:12px;
  display:flex;
  justify-content:center;
  gap:10px;
  flex-wrap: wrap;
}
.call-btn{
  text-decoration:none;
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:10px 12px;
  border-radius:999px;
  font-weight:800;
  font-size:13px;
  color:#fff;
  border:1px solid rgba(255,255,255,0.35);
  background: rgba(255,255,255,0.14);
}
.call-btn:hover{background: rgba(255,255,255,0.22);}
.form-body{padding:18px;}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
@media(max-width:720px){.grid2{grid-template-columns:1fr;}}
label{font-weight:700;font-size:13px;color: var(--dark);}
input,select,textarea{
  width:100%;
  padding:12px;
  margin:6px 0 14px;
  border-radius:12px;
  border:1px solid var(--border);
  background: rgba(255,255,255,0.95);
  outline:none;
  transition:0.2s;
}
input:focus,select:focus,textarea:focus{
  border-color: rgba(14,165,233,0.7);
  box-shadow:0 0 0 4px rgba(14,165,233,0.18);
}
small.note{display:block;margin-top:-10px;margin-bottom:12px;color: var(--muted);font-size:12px;}
.tests-area{border:1px solid var(--border);border-radius:14px;padding:12px;background: rgba(255,255,255,0.65);}
.category{margin-bottom:14px;}
.cat-title{display:flex;align-items:center;justify-content: space-between;gap:10px;margin:8px 0 10px;}
.cat-title h3{font-size:14px;margin:0;color: var(--dark);}
.cat-title span{font-size:12px;color: var(--muted);}
.tests-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
@media(max-width:720px){.tests-grid{grid-template-columns:1fr;}}
.test-item{
  display:flex;
  gap:10px;
  padding:10px;
  border:1px solid var(--border);
  border-radius:14px;
  background: rgba(255,255,255,0.92);
  cursor:pointer;
  transition:0.18s;
}
.test-item:hover{
  transform: translateY(-1px);
  border-color: rgba(14,165,233,0.55);
  box-shadow:0 10px 18px rgba(2,6,23,0.08);
}
.test-item input{width:auto;margin:3px 0 0;}
.test-name{font-weight:700;font-size:13px;margin:0;}
.test-price{font-size:12px;color: var(--muted);margin:3px 0 0;}
.summary{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:6px;}
@media(max-width:720px){.summary{grid-template-columns:1fr;}}
.total-box{padding:12px;border-radius:14px;border:1px solid var(--border);background: rgba(14,165,233,0.08);}
.total-box label{display:block;margin-bottom:6px;}
.total-input{font-size:20px;font-weight:800;color:#0369a1;}
.order-preview{padding:12px;border-radius:14px;border:1px solid var(--border);background: rgba(255,255,255,0.88);max-height:170px;overflow:auto;}
button{
  background: linear-gradient(135deg,var(--primary),var(--primary2));
  color:#fff;
  padding:13px 14px;
  border:none;
  border-radius:14px;
  cursor:pointer;
  width:100%;
  font-size:16px;
  font-weight:800;
  margin-top:12px;
  box-shadow:0 12px 22px rgba(14,165,233,0.2);
}
button:hover{filter: brightness(0.98);}
#confirmation{text-align:center;font-weight:bold;margin-top:14px;}
.action-row{
  display:flex;
  gap:10px;
  margin-top:10px;
  flex-wrap: wrap;
}
.action-row a{
  flex:1;
  min-width:180px;
  text-decoration:none;
  text-align:center;
  padding:12px;
  border-radius:14px;
  font-weight:800;
  border:1px solid var(--border);
  background: rgba(255,255,255,0.88);
  color: var(--dark);
}
.action-row a:hover{box-shadow:0 10px 18px rgba(2,6,23,0.10);transform: translateY(-1px);}
.footer-note{font-size:12px;color: var(--muted);text-align:center;padding:10px 0 16px;}
</style>
</head>

<body>

<div class="container">
  <div class="card">
    <div class="header">
      <h2>ðŸ§ª Mobile Lab Order Form</h2>
      <p>For the love of your health â€¢ Mityana & Nearby Areas</p>
      <div class="header-actions">
        <a class="call-btn" href="tel:+256778379791">ðŸ“ž Call MTN: +256 778 379 791</a>
        <a class="call-btn" href="tel:0750992939">ðŸ“ž Call Airtel: 0750 992 939</a>
      </div>
    </div>

<form id="orderForm" class="form-body">
  <div class="grid2">
    <div>
      <label for="name">Full Name</label>
      <input id="name" required placeholder="e.g. Namiyingo Joyce">
    </div>
    <div>
      <label for="phone">Phone</label>
      <input id="phone" required pattern="^(07|2567)[0-9]{8}$" placeholder="07XXXXXXXX or 2567XXXXXXXX">
      <small class="note">Example: 0750992939</small>
    </div>
    <div>
      <label for="age">Age</label>
      <input type="number" id="age" required placeholder="e.g. 25">
    </div>
    <div>
      <label for="sex">Sex</label>
      <select id="sex" required>
        <option value="">-- Select --</option>
        <option>Male</option>
        <option>Female</option>
        <option>Other</option>
      </select>
    </div>
    <div>
      <label for="location">Location</label>
      <input id="location" placeholder="Address or Google Maps link" required>
    </div>
  </div>

  <label>Select Tests</label>
  <div class="tests-area" id="testsContainer"></div>

  <div class="summary">
    <div class="total-box">
      <label>Total (UGX)</label>
      <div class="total-input" id="totalText">0</div>
      <input id="total" readonly value="0" style="display:none">
    </div>
    <div class="order-preview" id="preview">No tests selected</div>
  </div>

  <button type="submit">Submit Order via WhatsApp</button>

  <div id="confirmation"></div>

  <div class="action-row" id="afterActions" style="display:none;">
    <a id="sendScreenshotBtn" href="#" target="_blank">ðŸ“¸ Send Screenshot of Order</a>
    <a href="admin.html">ðŸ“‹ View Admin Orders</a>
  </div>

  <div class="footer-note">
    Sample collection available within Mityana & nearby areas.
  </div>
</form>
  </div>
</div>

<script>
// âœ… Firebase init
const firebaseConfig = {
  apiKey:"AIzaSyA4II_I1weZZGzP990t9UWJCXjuK932pdY",
  authDomain:"mobile-lab-mityana-aeae2.firebaseapp.com",
  projectId:"mobile-lab-mityana-aeae2"
};
if(!firebase.apps.length) firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

// ---------- TESTS ----------
const testCategories=[
  {title:"Blood Tests",tests:[
    {name:"CBC - Complete Blood Count",price:15000},
    {name:"Blood Glucose",price:7000},
    {name:"Blood Grouping",price:10000},
    {name:"Bleeding & Clotting Test",price:15000},
    {name:"malaria (b/s)",price:5000}
  ]},
  {title:"Infections / STIs",tests:[
    {name:"HIV",price:7000},
    {name:"Hepatitis B",price:10000},
    {name:"RPR / Syphilis",price:8000}
  ]}
];

const testsContainer=document.getElementById("testsContainer");
const totalInput=document.getElementById("total");
const totalText=document.getElementById("totalText");
const preview=document.getElementById("preview");
const afterActions=document.getElementById("afterActions");
const sendScreenshotBtn=document.getElementById("sendScreenshotBtn");

// Inputs
const nameInput=document.getElementById("name");
const phoneInput=document.getElementById("phone");
const ageInput=document.getElementById("age");
const sexInput=document.getElementById("sex");
const locationInput=document.getElementById("location");

// Admin WhatsApp
const adminWhatsApp="256750992939";

// Render tests
function renderTests(){
  testsContainer.innerHTML="";
  testCategories.forEach(cat=>{
    const wrapper=document.createElement("div");
    wrapper.className="category";
    const title=document.createElement("div");
    title.className="cat-title";
    title.innerHTML=`<h3>âœ… ${cat.title}</h3><span>${cat.tests.length} tests</span>`;
    wrapper.appendChild(title);

    const grid=document.createElement("div");
    grid.className="tests-grid";
    cat.tests.forEach(t=>{
      const label=document.createElement("label");
      label.className="test-item";
      const cb=document.createElement("input");
      cb.type="checkbox"; cb.value=t.name; cb.dataset.price=t.price; cb.onchange=updateTotal;
      const info=document.createElement("div");
      info.innerHTML=`<p class="test-name">${t.name}</p><p class="test-price">UGX ${t.price.toLocaleString()}</p>`;
      label.appendChild(cb); label.appendChild(info);
      grid.appendChild(label);
    });
    wrapper.appendChild(grid);
    testsContainer.appendChild(wrapper);
  });
}
renderTests();

// Update total
function updateTotal(){
  let total=0; let list=[];
  document.querySelectorAll("#testsContainer input[type='checkbox']:checked").forEach(cb=>{
    total+=Number(cb.dataset.price);
    list.push(`${cb.value} (UGX ${Number(cb.dataset.price).toLocaleString()})`);
  });
  totalInput.value=total;
  totalText.innerText=total.toLocaleString();
  preview.innerHTML=list.length ? list.join("<br>") : "No tests selected";
}

// Submit
document.getElementById("orderForm").onsubmit=e=>{
  e.preventDefault();
  if(Number(totalInput.value)===0){alert("Please select at least one test"); return;}
  const orderId="ML-"+Date.now();
  const orderText=`Order ID: ${orderId}\nName: ${nameInput.value}\nPhone: ${phoneInput.value}\nAge: ${ageInput.value}\nSex: ${sexInput.value}\nLocation: ${locationInput.value}\nTests:\n${preview.innerText}\nTotal: UGX ${totalInput.value.toLocaleString()}`;

  // WhatsApp to admin
  window.open(`https://wa.me/${adminWhatsApp}?text=${encodeURIComponent(orderText)}`);

  // Prepare screenshot link
  sendScreenshotBtn.href=`https://wa.me/${adminWhatsApp}?text=${encodeURIComponent("I am sending the screenshot of my order "+orderId)}`;
  afterActions.style.display="flex";
  document.getElementById("confirmation").innerText="âœ… Order submitted! Please send a screenshot via WhatsApp.";
  e.target.reset();
  preview.innerHTML="No tests selected";
  totalInput.value="0"; totalText.innerText="0";
};
</script>

</body>
</html>
